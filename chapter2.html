<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 2: Insignia of the Sun - Pop Song Summer</title>
    <meta name="description" content="Chapter 2 of Pop Song Summer: Insignia of the Sun - A hallucinatory dive into a symbol's grip.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="./css/output.css">
    
    <style>
        /* Base styles */
        body {
            background-color: #1A2A44;
            color: #F5F1E9;
            font-family: 'Crimson Text', serif;
            line-height: 1.9;
            overflow: hidden;
        }
        
        /* Impress.js slide styles */
        .impress-enabled .step {
            background: linear-gradient(135deg, rgba(26, 42, 68, 0.9), rgba(0, 0, 0, 0.7));
            border-radius: 0.5rem;
            box-shadow: 0 0 20px rgba(255, 193, 7, 0.3);
            width: 700px;
            height: 450px;
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
            display: flex;
            transition: transform 0.5s ease, opacity 0.5s ease;
        }
        
        .panel-content {
            width: 75%;
            padding: 1rem;
            z-index: 2;
        }
        
        .panel-accent {
            width: 25%;
            position: relative;
            z-index: 1;
        }
        
        .panel-text {
            font-size: 1rem;
            line-height: 1.8;
            color: #F5F1E9;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        
        /* Story header */
        .story-header {
            padding: 4rem 1rem;
            text-align: center;
            background: radial-gradient(circle, rgba(255, 51, 102, 0.4), rgba(26, 42, 68, 0.8));
            position: relative;
            overflow: hidden;
        }
        
        .story-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: #FFC107;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.7);
            animation: glitch 2s infinite;
        }
        
        .story-subtitle {
            font-family: 'Crimson Text', serif;
            font-size: 1.2rem;
            color: #26A69A;
            text-shadow: 0 0 5px rgba(38, 166, 154, 0.5);
        }
        
        .story-quote {
            font-style: italic;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 1.5rem;
            color: #FF3366;
            border-left: 3px solid #FFC107;
            padding-left: 1rem;
            animation: pulse-text 3s infinite;
        }
        
        /* Visual elements */
        .insignia {
            color: #FFC107;
            font-size: 1em;
            margin: 0 0.2em;
            display: inline-block;
            transition: transform 0.3s ease;
        }
        
        .insignia:hover {
            transform: scale(1.2) rotate(10deg);
            text-shadow: 0 0 10px #FFC107;
        }
        
        .large-insignia {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            opacity: 0.2;
            pointer-events: none;
            animation: spin 10s linear infinite;
        }
        
        .large-insignia .circle {
            width: 100%;
            height: 100%;
            border: 4px solid #FFC107;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle, rgba(255, 193, 7, 0.3), transparent);
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.5);
        }
        
        .large-insignia .sun {
            font-size: 3rem;
            color: #FFC107;
            animation: pulse 2s infinite;
        }
        
        .burning-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 51, 0, 0.3), transparent);
            mix-blend-mode: overlay;
            pointer-events: none;
            animation: flicker 1s infinite;
        }
        
        .candle-flicker {
            animation: candle-glow 1.5s infinite alternate;
        }
        
        /* Audio controls */
        .audio-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(26, 42, 68, 0.9);
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }
        
        .audio-controls button {
            background: none;
            border: none;
            color: #FFC107;
            cursor: pointer;
            font-size: 1.2rem;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .audio-controls button:hover {
            background: rgba(255, 51, 102, 0.2);
            transform: scale(1.1);
        }
        
        /* Audio progress indicator */
        .audio-progress {
            position: fixed;
            bottom: 20px;
            right: 80px;
            z-index: 1000;
            background: rgba(26, 42, 68, 0.9);
            color: #FFC107;
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }
        
        /* Navigation controls */
        .nav-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }
        
        .nav-controls button {
            background: rgba(26, 42, 68, 0.9);
            color: #FFC107;
            border: none;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        }
        
        .nav-controls button:hover {
            background: rgba(255, 51, 102, 0.2);
            transform: rotate(10deg);
        }
        
        /* Choice button */
        .choice-btn {
            background: #FFC107;
            color: #1A2A44;
            padding: 0.5rem 1rem;
            border-radius: 0.3rem;
            border: none;
            cursor: pointer;
            font-family: 'Crimson Text', serif;
            font-size: 0.9rem;
            margin: 0.5rem 0.5rem 0 0;
            transition: all 0.3s ease;
        }
        
        .choice-btn:hover {
            background: #FF3366;
            color: #F5F1E9;
            box-shadow: 0 0 10px rgba(255, 51, 102, 0.7);
        }
        
        /* Animations */
        @keyframes glitch {
            0% { text-shadow: 0 0 5px #FFC107, 0 0 10px #FF3366; }
            2% { text-shadow: 2px 2px 5px #26A69A, -2px -2px 10px #FFC107; }
            4% { text-shadow: none; }
            100% { text-shadow: 0 0 5px #FFC107, 0 0 10px #FF3366; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.2; }
            50% { transform: scale(1.1); opacity: 0.4; }
            100% { transform: scale(1); opacity: 0.2; }
        }
        
        @keyframes pulse-text {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        
        @keyframes flicker {
            0% { opacity: 0.2; }
            50% { opacity: 0.4; }
            100% { opacity: 0.2; }
        }
        
        @keyframes candle-glow {
            0% { text-shadow: 0 0 5px rgba(255, 51, 0, 0.5); }
            50% { text-shadow: 0 0 10px rgba(255, 51, 0, 0.7); }
            100% { text-shadow: 0 0 5px rgba(255, 51, 0, 0.5); }
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .story-title {
                font-size: 2rem;
            }
            .impress-enabled .step {
                width: 90vw;
                height: 50vh;
                padding: 1rem;
            }
            .panel-content {
                width: 100%;
            }
            .panel-accent {
                display: none;
            }
        }
        
        @media (max-width: 480px) {
            .story-title {
                font-size: 1.5rem;
            }
            .impress-enabled .step {
                padding: 0.75rem;
            }
            .panel-text {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Element (Hidden) -->
    <audio id="background-music" loop>
        <source src="music/Chapter 2_Insignia of the Sun.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    
    <!-- Audio Controls -->
    <div class="audio-controls">
        <button id="play-pause-btn" title="Play/Pause" aria-label="Play or pause background music">▶</button>
        <button id="restart-btn" title="Restart" aria-label="Restart background music">↻</button>
    </div>
    
    <!-- Audio Progress -->
    <div class="audio-progress" id="audio-progress">0:00 / 8:30</div>
    
    <!-- Navigation Controls -->
    <div class="nav-controls">
        <button id="prev-btn" title="Previous Slide" aria-label="Go to previous slide">←</button>
        <button id="next-btn" title="Next Slide" aria-label="Go to next slide">→</button>
    </div>
    
    <!-- Impress.js Container -->
    <div id="impress">
        <!-- Intro Slide -->
        <div class="step" data-x="0" data-y="0" data-scale="1" data-rotate-z="0">
            <div class="story-header">
                <h1 class="story-title">Insignia of the Sun</h1>
                <p class="story-subtitle">Pop Song Summer, Track 2</p>
                <blockquote class="story-quote">
                    "She comes. What do you return?"
                </blockquote>
                <button id="start-reading-btn" class="bg-golden-blaze text-navy px-5 py-2 rounded-md hover:bg-opacity-80 transition-colors font-bold text-base">
                    Enter the Spiral
                </button>
            </div>
        </div>
        
        <!-- Story Panels (Spiral Layout) -->
        <div class="step" data-x="1000" data-y="0" data-rotate-z="0" data-scale="0.8" data-background="bg-gradient-to-b from-[#1A1A1A] via-[#4A4A4A] to-[#1A1A1A]">
            <div class="panel-content">
                <p class="panel-text">The first time I saw the insignia was on a body bag. White vinyl, zipped to the chin, toes tagged. On the sleeve: a <span class="insignia">☀</span> in gold thread, twelve rays, perfect circle, too clean for a morgue. The coroner, chewing a burrito over an EVIDENCE folder, catches me staring. 'Not county,' he says, voice like sandpaper. 'Some club, maybe.' I tell him clubs don’t stitch couture onto body bags. He shrugs, uninterested.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="1046" data-y="314" data-rotate-z="30" data-scale="0.9" data-background="bg-gradient-to-b from-[#4A4A4A] via-[#2D2D2D] to-[#4A4A4A]">
            <div class="panel-content">
                <p class="panel-text">I’m a stringer, chasing tragedies for gas money. The patch burns a hole in my vision. 'Mind if I shoot it?' I ask. The coroner smirks, 'Shoot anything that can’t shoot back.' I take three photos: wide for context, close for thread, angled for pop. On my camera screen, the gold moirés into a halo, like it knows it’s being watched.</p>
            </div>
            <div class="panel-accent"></div>
        </div>
        <div class="step" data-x="1219" data-y="640" data-rotate-z="60" data-scale="0.8" data-background="bg-gradient-to-b from-[#1A2A44] via-[#000000] to-[#1A2A44]">
            <div class="panel-content">
                <p class="panel-text">On the morgue’s bulletin board, among missing persons and grief group flyers, a 3×5 index card: TWELVE RAYS / TWELVE DOORS / SHE COMES WITH THE SUN. Below, a number: 555-0199. No name, just cult-startup confidence. I’ve seen the mark before—gas station graffiti, a thrift store book, a flyer for a band that never played. It’s a breadcrumb I can’t unsee.</p>
            </div>
            <div class="panel-accent"></div>
        </div>
        <div class="step" data-x="1490" data-y="990" data-rotate-z="90" data-scale="0.9" data-background="bg-gradient-to-b from-[#2D2D2D] via-[#1A1A1A] to-[#2D2D2D]">
            <div class="panel-content">
                <p class="panel-text">In my car, I call the number. One ring, then a dial tone like a flatline. The city flickers outside, an arcade left on after hours. I drive to the overpass by the old mall, where the body was found. A shrine waits: candles, a wax-splotched Polaroid, bodega flowers. On the concrete pillar, a spray-painted <span class="insignia">☀</span>, twelve rays, glitter and ash caught in the paint.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="1820" data-y="1378" data-rotate-z="120" data-scale="0.8" data-background="bg-gradient-to-b from-[#800020] via-[#4A0000] to-[#800020]">
            <div class="panel-content">
                <p class="panel-text">Under the spray paint, in felt-tip: WE RETURN WHAT WE TAKE. My shoe slides on candle wax, and my palm catches the pillar, leaving a crescent of black. Across the street, a woman’s silhouette passes a TV’s blue glow. Not in red. I exhale. The morgue shots on my camera make the gold thread brighter than the world around it.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="2222" data-y="1857" data-rotate-z="150" data-scale="0.9" data-background="bg-gradient-to-b from-[#1A0E25] via-[#2D0A31] to-[#1A0E25]">
            <div class="panel-content">
                <p class="panel-text">A tip leads me to the dead man’s apartment. Room 3B is urban decay in a mold: empty cabinets, mattress on the floor, cinder-block bookshelf. Twelve books, counted on reflex: Neuromancer, Valis, a zine titled <span class="insignia">☀</span> with a gold-leaf sunburst. Its pages are poem-prayers, each ending with 555-0199. A shoebox under the mattress holds pay stubs, a yearbook photo, and three gold-thread patches.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="2713" data-y="2423" data-rotate-z="180" data-scale="0.8" data-background="bg-gradient-to-b from-[#2D0A31] via-[#4A0000] to-[#2D0A31]">
            <div class="panel-content">
                <p class="panel-text">Inside the shoebox lid: RETURN LIGHT / RETURN BODY / RETURN NAME. Below: WED, 9PM, UNIT 413. No address, but I know a self-storage place nearby with a unit 413. I pocket the note, not the patch, though shame and thrill fight under my tongue. The zine’s first poem haunts: 'Draw the circle, count the rays. She comes.'</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="3315" data-y="3146" data-rotate-z="210" data-scale="0.9" data-background="bg-gradient-to-b from-[#1A2A44] via-[#000000] to-[#1A2A44]">
            <div class="panel-content">
                <p class="panel-text candle-flicker">The storage place is a tin-box maze. I slip past the gate and roll under unit 413’s half-open door. Inside: twelve red candles in a circle, a milk crate altar with a duct-taped cassette player, <span class="insignia">☀</span> zines, and a jar of sunburst patches. A woman’s voice from the cassette: 'She comes. What do you return?' Name, light, body. The tape stops. Silence.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="4049" data-y="4080" data-rotate-z="240" data-scale="0.8" data-background="bg-gradient-to-b from-[#2D0A31] via-[#1A0E25] to-[#2D0A31]">
            <div class="panel-content">
                <h2 class="text-2xl font-bold neon-gold">Heliograph</h2>
                <p class="panel-text">Footsteps. The door rolls up. A tall, androgynous figure with a <span class="insignia">☀</span> jacket steps in. 'You’re early,' they say. 'Or late.' They call it Heliograph—an instrument to talk to the sun. 'We don’t own the insignia,' they say. 'It owns us.' A second figure sets up a folding table, wax on their cuff. 'Meeting’s at nine,' they warn. I leave before it starts.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="4945" data-y="5282" data-rotate-z="270" data-scale="0.9" data-background="bg-gradient-to-b from-[#1A2A44] via-[#FFC107] to-[#1A2A44]">
            <div class="panel-content">
                <p class="panel-text">The <span class="insignia">☀</span> stalks me. On a painter’s cuff, a web ad, a thrift store jacket. A disco song about horizons hums on the radio. At a coffee shop, a guy with a sunburst patch calls it 'vintage.' His calendar has twelve events marked 'return.' The air wobbles. I’m chasing a symbol that’s chasing me back.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="6042" data-y="6838" data-rotate-z="300" data-scale="0.8" data-background="bg-gradient-to-b from-[#4A4A4A] via-[#2D2D2D] to-[#4A4A4A]">
            <div class="panel-content">
                <p class="panel-text">At the library, Mari pulls microfiche. We find twelve house fires over eleven summers, a band called <span class="insignia">☀</span> of the Sun that blacked out a grid, a singer with a gold-thread sunburst. Two fires at storage units, one near a freeway. A bulletin board card reads: RETURN LIGHT / RETURN NAME / RETURN BODY. WEDS 9PM / UNIT 413. The pin has a sunburst head.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="7382" data-y="8852" data-rotate-z="330" data-scale="0.9" data-background="bg-gradient-to-b from-[#800020] via-[#4A0000] to-[#800020]">
            <div class="panel-content">
                <h2 class="text-2xl font-bold neon-red">Ritual Night</h2>
                <p class="panel-text candle-flicker">Wednesday, 9PM. Unit 413 is alive. Twelve people, twelve candles, a new speaker. The androgynous host stands watch. A woman’s voice—not from the speaker—starts the call: 'She comes. What do you return?' Name, light, body. The candles light clockwise, a clock that ignores time. The woman in red steps in, her <span class="insignia">☀</span> humming.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="9016" data-y="11458" data-rotate-z="360" data-scale="0.8" data-background="bg-gradient-to-b from-[#2D0A31] via-[#1A0E25] to-[#2D0A31]">
            <div class="panel-content">
                <p class="panel-text candle-flicker">She hands me a patch. It’s heavy, not hot. 'You brought him here,' she says, meaning the dead man. I protest, but she says I know everyone—it’s my job. The group hums, a frequency that turns the unit into a throat. The candles gutter backward. The door ceases to be a boundary. On the horizon: fire.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
                <div class="burning-overlay"></div>
            </div>
        </div>
        <div class="step" data-x="11013" data-y="14823" data-rotate-z="390" data-scale="0.9" data-background="bg-gradient-to-b from-[#1A2A44] via-[#000000] to-[#1A2A44]">
            <div class="panel-content">
                <p class="panel-text candle-flicker">She kisses the patch, presses it to the concrete. It burns a <span class="insignia">☀</span> into the floor. A body bag appears in the circle, white vinyl, sunburst on the sleeve. 'Returns make us real,' she says. Two people lift the bag. The host draws a chalk sunburst. 'No photos,' they say. I hadn’t tried.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
                <div class="burning-overlay"></div>
            </div>
        </div>
        <div class="step" data-x="13448" data-y="19174" data-rotate-z="420" data-scale="0.8" data-background="bg-gradient-to-b from-[#1A2A44] via-[#FFC107] to-[#1A2A44]">
            <div class="panel-content">
                <p class="panel-text">At home, the morgue’s index card falls from my notebook. With it: a <span class="insignia">☀</span> patch I didn’t take. My heart snaps. I dial the second number. My own voice answers: 'Return what isn’t yours.' The city blinks a sunburst in red exit-sign light. I sleep badly. In the morning, the patch is pinned to my jacket.</p>
                <button class="choice-btn" data-choice="keep">Keep the Patch</button>
                <button class="choice-btn" data-choice="return">Return the Patch</button>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="16427" data-y="24796" data-rotate-z="450" data-scale="0.9" data-background="bg-gradient-to-b from-[#2D2D2D] via-[#1A1A1A] to-[#2D2D2D]">
            <div class="panel-content">
                <p class="panel-text">I write to pin the story down. Morgue, body bag, candles, clock. The radio plays the horizon song. My phone buzzes. Her voice: 'Start with the name.' I delete my byline. The cursor blinks. The patch weighs like an oath. Outside, sirens call. A kid’s chalk <span class="insignia">☀</span> on the floor says: 'She comes. We’re ready.'</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
        <div class="step" data-x="20065" data-y="32062" data-rotate-z="480" data-scale="1" data-background="bg-gradient-to-b from-[#FFC107] via-[#FF3300] to-[#FFC107]">
            <div class="panel-content">
                <p class="panel-text">I step into the morning. The <span class="insignia">☀</span> isn’t a brand—it’s a receipt. You borrow light, you return it. Across the street, the woman in red pauses, her sunburst flaring. She looks through me, like I’m a pattern in the algorithm. I walk, patch unpinned, toward a city of twelve doors. The horizon burns. She comes.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
                <div class="burning-overlay"></div>
            </div>
        </div>
        <!-- Choice Outcome Slides -->
        <div class="step choice-outcome" data-x="24501" data-y="41467" data-rotate-z="510" data-scale="0.8" data-background="bg-gradient-to-b from-[#FF3366] via-[#1A2A44] to-[#FF3366]">
            <div class="panel-content">
                <p class="panel-text">You keep the patch. It hums against your chest, a pulse that syncs with the city’s neon. The horizon flickers, and your shadow grows twelve rays. You’re marked now, part of the spiral. The woman in red smiles—she knows you’ll return.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
                <div class="burning-overlay"></div>
            </div>
        </div>
        <div class="step choice-outcome" data-x="29922" data-y="53632" data-rotate-z="540" data-scale="0.8" data-background="bg-gradient-to-b from-[#1A2A44] via-[#000000] to-[#1A2A44]">
            <div class="panel-content">
                <p class="panel-text">You return the patch. It burns as it leaves your hand, dissolving into ash. The city exhales, and the sirens fade. The woman in red nods, but her eyes linger—you’ve escaped the spiral, but the sun still watches.</p>
            </div>
            <div class="panel-accent">
                <div class="large-insignia"><div class="circle"><div class="sun">☀</div></div></div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="js/impress.js"></script>
    <script>
        // Fallback for Impress.js
        if (typeof impress === 'undefined') {
            console.error('Impress.js failed to load. Check js/impress.js path.');
            document.getElementById('impress').style.display = 'none';
            document.body.innerHTML += '<p style="color: #FFF; text-align: center;">Error: Presentation could not load. Please check js/impress.js.</p>';
        } else {
            document.addEventListener('DOMContentLoaded', function() {
                // Initialize Impress.js
                try {
                    impress().init();
                } catch (e) {
                    console.error('Impress.js initialization failed:', e);
                }
                
                // DOM Elements
                const audio = document.getElementById('background-music');
                const playPauseBtn = document.getElementById('play-pause-btn');
                const restartBtn = document.getElementById('restart-btn');
                const startReadingBtn = document.getElementById('start-reading-btn');
                const prevBtn = document.getElementById('prev-btn');
                const nextBtn = document.getElementById('next-btn');
                const audioProgress = document.getElementById('audio-progress');
                
                // Function to format time in MM:SS
                function formatTime(seconds) {
                    const minutes = Math.floor(seconds / 60);
                    const remainingSeconds = Math.floor(seconds % 60);
                    return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
                }
                
                // Function to initialize GSAP animations
                function initAnimations() {
                    // Animate insignia
                    gsap.utils.toArray('.large-insignia').forEach((insignia) => {
                        gsap.to(insignia, {
                            opacity: 0.4,
                            duration: 3,
                            repeat: -1,
                            yoyo: true,
                            ease: "sine.inOut"
                        });
                    });
                    
                    // Animate burning overlay
                    gsap.utils.toArray('.burning-overlay').forEach((overlay) => {
                        gsap.to(overlay, {
                            opacity: 0.5,
                            duration: 2,
                            repeat: -1,
                            yoyo: true,
                            ease: "sine.inOut"
                        });
                    });
                    
                    // Audio volume dip on slide transition
                    document.addEventListener('impress:stepenter', () => {
                        gsap.to(audio, { volume: 0.7, duration: 0.5, onComplete: () => {
                            gsap.to(audio, { volume: 1, duration: 0.5 });
                        }});
                    });
                }
                
                // Function to update audio progress
                function updateAudioProgress() {
                    if (!audio.paused) {
                        const currentTime = formatTime(audio.currentTime);
                        const duration = formatTime(audio.duration || 510);
                        audioProgress.textContent = `${currentTime} / ${duration}`;
                        requestAnimationFrame(updateAudioProgress);
                    }
                }
                
                // Event Listeners
                startReadingBtn.addEventListener('click', function() {
                    this.parentElement.parentElement.classList.remove('active');
                    impress().goto(1);
                    audio.play();
                    playPauseBtn.textContent = '❚❚';
                    updateAudioProgress();
                });
                
                playPauseBtn.addEventListener('click', function() {
                    if (audio.paused) {
                        audio.play();
                        this.textContent = '❚❚';
                        updateAudioProgress();
                    } else {
                        audio.pause();
                        this.textContent = '▶';
                    }
                });
                
                restartBtn.addEventListener('click', function() {
                    audio.currentTime = 0;
                    if (audio.paused) {
                        audio.play();
                        playPauseBtn.textContent = '❚❚';
                        updateAudioProgress();
                    }
                });
                
                prevBtn.addEventListener('click', function() {
                    impress().prev();
                });
                
                nextBtn.addEventListener('click', function() {
                    impress().next();
                });
                
                // Choice buttons
                document.querySelectorAll('.choice-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const choice = this.getAttribute('data-choice');
                        const outcomeSlide = choice === 'keep' ? 18 : 19;
                        impress().goto(outcomeSlide);
                        gsap.to(audio, { volume: 0.3, duration: 1, onComplete: () => {
                            gsap.to(audio, { volume: 1, duration: 1 });
                        }});
                    });
                });
                
                // Insignia hover effect
                gsap.utils.toArray('.insignia').forEach((insignia) => {
                    insignia.addEventListener('mouseenter', () => {
                        gsap.to(insignia, { scale: 1.3, color: '#FF3366', duration: 0.3 });
                    });
                    insignia.addEventListener('mouseleave', () => {
                        gsap.to(insignia, { scale: 1, color: '#FFC107', duration: 0.3 });
                    });
                });
                
                // Initialize audio duration
                audio.addEventListener('loadedmetadata', function() {
                    const duration = formatTime(audio.duration);
                    audioProgress.textContent = `0:00 / ${duration}`;
                });
                
                // Initialize animations
                initAnimations();
            });
        }
    </script>
</body>
</html>